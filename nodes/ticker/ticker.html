<script type="text/javascript">
  RED.nodes.registerType('trading-ticker',{
      category: 'Trading SaaS',
      color: '#8bc34a',
      defaults: {
          name: { value: "" }
      },
      inputs: 0,
      outputs: 1,
      icon: "font-awesome/fa-line-chart",
      label: function() {
          return this.name || "trading-ticker";
      }
  });
  </script>
  
  <script type="text/javascript">
    (function () {
        if (window.__TRADING_GUARD_LOADED__) return;
        window.__TRADING_GUARD_LOADED__ = true;
    
        console.log("üõ°Ô∏è [Trading Guard] bootstrap loaded");
    
        function installGuard() {
            if (!RED || !RED.nodes || !RED.view) {
                setTimeout(installGuard, 50);
                return;
            }
    
            console.log("üõ°Ô∏è [Trading Guard] installing guards");
    
            /* ===== 1. R√àGLE M√âTIER CAN-LINK (FONDATION) ===== */
            const originalCanLink = RED.nodes.canLink;
            RED.nodes.canLink = function (src, dst, srcPort, dstPort) {
                if (
                    src?.type === "trading-ticker" &&
                    dst?.type === "trading-backtest"
                ) {
                    return false; // ‚õî BLOQUAGE ABSOLU
                }
                return originalCanLink.apply(this, arguments);
            };
    
            /* ===== 2. UX : FEEDBACK UTILISATEUR ===== */
            const originalAddLink = RED.view.addLink;
            RED.view.addLink = function () {
                const link = arguments[0];
                const srcNode = RED.nodes.node(link?.source?.node);
                const dstNode = RED.nodes.node(link?.target?.node);
    
                if (
                    srcNode?.type === "trading-ticker" &&
                    dstNode?.type === "trading-backtest"
                ) {
                    RED.notify(
                        "‚ùå Connexion interdite : trading-ticker ‚Üí trading-backtest",
                        "error"
                    );
                    return false;
                }
    
                return originalAddLink.apply(this, arguments);
            };
    
            console.log("‚úÖ [Trading Guard] HARD BLOCK active");
        }
    
        installGuard();
    })();
    </script>
        