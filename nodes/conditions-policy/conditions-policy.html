<script type="text/javascript">
    (function () {
      "use strict";
    
      if (window.__CONDITIONS_POLICY_LOADED__) return;
      window.__CONDITIONS_POLICY_LOADED__ = true;
    
      console.log("[ConditionsPolicy] loaded");
    
      function enforceSingleInput() {
        const counts = {};
    
        RED.nodes.eachLink(function (link) {
          const tgt = RED.nodes.node(link.target.id);
          if (!tgt) return;
    
          if (tgt.type === "conditions") {
            counts[tgt.id] = (counts[tgt.id] || 0) + 1;
          }
        });
    
        Object.keys(counts).forEach(id => {
          if (counts[id] > 1) {
            let seen = 0;
            RED.nodes.eachLink(function (link) {
              if (link.target.id === id) {
                seen++;
                if (seen > 1) {
                  RED.nodes.removeLink(link);
                  RED.notify(
                    "Le node Conditions n'accepte qu'une seule source en entr√©e",
                    "error"
                  );
                }
              }
            });
          }
        });
      }
    
      RED.events.on("links:add", enforceSingleInput);
      RED.events.on("nodes:add", enforceSingleInput);
      RED.events.on("workspace:change", enforceSingleInput);
    
      setTimeout(enforceSingleInput, 0);
    })();
    </script>
    