<script type="text/javascript">
  RED.nodes.registerType('trading-ticker',{
      category: 'Trading SaaS',
      color: '#8bc34a',
      defaults: {
          name: { value: "" }
      },
      inputs: 0,
      outputs: 1,
      icon: "font-awesome/fa-line-chart",
      label: function() {
          return this.name || "trading-ticker";
      }
  });
</script>

<script type="text/javascript">
    (function () {
      "use strict";
    
      if (window.__TRADING_POLICY_GLOBAL__) {
        return;
      }
    
      console.log("[TradingPolicy][GLOBAL] injected");
    
      const ALLOWED = {
        "trading-ticker": ["trading-indicator"],
        "trading-indicator": [
          "trading-indicator",
          "trading-condition",
          "trading-backtest"
        ],
        "trading-condition": ["trading-backtest"],
        "trading-backtest": []
      };
    
      function validateAllLinks(origin) {
        console.log("[TradingPolicy][GLOBAL] validateAllLinks", origin);
    
        RED.nodes.eachLink(function (link) {
          const srcNode = RED.nodes.node(link.source.id);
          const tgtNode = RED.nodes.node(link.target.id);
    
          if (!srcNode || !tgtNode) return;
    
          const allowedTargets = ALLOWED[srcNode.type] || [];
    
          if (!allowedTargets.includes(tgtNode.type)) {
            console.warn(
              "[TradingPolicy][GLOBAL] forbidden",
              srcNode.type,
              "‚Üí",
              tgtNode.type
            );
    
            RED.nodes.removeLink(link);
            RED.notify(
              `Connexion interdite : ${srcNode.type} ‚Üí ${tgtNode.type}`,
              "error"
            );
          }
        });
      }
    
      // üîë Activation diff√©r√©e, quand l‚Äô√©diteur est pr√™t
      RED.events.on("workspace:change", function () {
        validateAllLinks("workspace:change");
      });
    
      // üîÅ Validation continue
      RED.events.on("links:add", function () {
        validateAllLinks("links:add");
      });
    
      RED.events.on("nodes:add", function () {
        validateAllLinks("nodes:add");
      });
    
      // üõ°Ô∏è Fallback s√©curit√© (flows d√©j√† charg√©s au refresh)
      setTimeout(function () {
        validateAllLinks("initial-timeout");
      }, 0);
    
      window.__TRADING_POLICY_GLOBAL__ = true;
    })();
    </script>
       
  
           